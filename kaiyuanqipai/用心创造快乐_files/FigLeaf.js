function initFigLeaf(){faelgif=new FigLeafClient.Main}function callFigLeaf(t,e){faelgif?faelgif.outterCommandCall(t,e):faelgif=new FigLeafClient.Main}var H5Event,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){var e=function(){function e(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this._stopOtherListener=!1,this._stopCommunication=!1,this._type=t,this._bubbles=e,this._currentTarget=null,this._target=null,this._sendObject=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},set:function(t){this._currentTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendObject",{get:function(){return this._sendObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopOtherListener",{get:function(){return this._stopOtherListener},set:function(t){this._stopOtherListener=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopCommunication",{get:function(){return this._stopCommunication},set:function(t){this._stopCommunication=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new t.H5BaseEvent(this._type,this._bubbles,this._sendObject)},e.COMPLETE="H5Event_complete",e.CHANGE="H5Event_change",e.REMOVED="H5Event_removed",e.IO_ERROR="H5Event_ioError",e}();t.H5BaseEvent=e}(H5Event||(H5Event={}));var H5EventdispatcherCore;!function(t){var e=function(){function t(){this._objEvent={},this._aryBubbles=[]}return t.prototype.addEventListener=function(t,e){void 0===this._objEvent[t]&&(this._objEvent[t]=[]),-1===this.getIndex(t,e)&&this._objEvent[t].push(e)},t.prototype.removeEventListener=function(t,e){var n=this._objEvent[t];if(n)for(var i=n.length,o=0;o<i;o++)if(n[o]===e){n.splice(o,1),0==n.length&&delete this._objEvent[t];break}},t.prototype.removeEventListeners=function(t){void 0===t&&(t=""),void 0!==this._objEvent[t]?delete this._objEvent[t]:""==t&&(this._objEvent=null)},t.prototype.hasEventListener=function(t){return!!this._objEvent[t]},t.prototype.dispatchEvent=function(t){var e=t.target;t.target=this,t.bubbles?this.bubbleEvt(t):this.invokeEvt(t),null!=e&&(t.target=e)},t.prototype.invokeEvt=function(t){var e=this._objEvent[t.type];if((void 0!==e?e.length:0)>0){var n=e.length;t.currentTarget=this;for(var i=0;i<n;i++)if(e[i](t),t.stopCommunication)return!0;return t.stopOtherListener}return!1},t.prototype.bubbleEvt=function(t){var e,n=1,i=this;for((e=this._aryBubbles.length>0?this._aryBubbles.pop():[]).push(i);null!=(i=i.parent);)e[n++]=i;for(var o=0;o<n;o++){if(e[o].invokeEvt(t))break}e.length=0,this._aryBubbles.push(e)},t.prototype.getIndex=function(t,e){var n=-1;if(void 0!==this._objEvent[t])for(var i=this._objEvent[t],o=i.length,r=0;r<o;r++)if(i[r]===e){n=r;break}return n},t}();t.EventDispatcher=e}(H5EventdispatcherCore||(H5EventdispatcherCore={}));var ConnecterTools;!function(t){t.getConnectIP=function(t,e,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE&&200==i.status){i.responseText;var t=JSON.parse(i.responseText);t.data,null!=t.data?e(t.data):n()}},i.open("GET",t,!0),i.send()},t.getRandInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.getWSConnectPath=function(t,e,n){return(t?"wss://":"ws://")+e+n}}(ConnecterTools||(ConnecterTools={}));!function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.NET_STATUS="NET_STATUS",e.HALL_STATUS="HALL_STATUS",e.COUNTDOWN1="COUNTDOWN1",e.COUNTDOWN2="COUNTDOWN2",e.MAINTAIN_START="MAINTAIN_START",e.UNDER_MAINTAIN_SEQUENCE="UNDER_MAINTAIN_SEQUENCE",e.MARQUEE="MARQUEE",e.MAINTAIN_INFO="MAINTAIN_INFO",e.OUTPUT_DATA="OUTPUT_DATA",e.UPDATE_LINE_USER="UPDATE_LINE_USER",e}(H5Event.H5BaseEvent);t.FigLeafEvent=e}(FigLeafClient||(FigLeafClient={}));!function(t){var e=t.FigLeafEvent,n=function(t){function n(){var e=t.call(this)||this;return e.gatewayPath="",e._ip="",e._lang="",e.regetIPCounter=0,e.reconnectCounter=0,e._sid="",e.updateProgress=function(t){},e.transferComplete=function(t){},e.transferFailed=function(t){},e.transferCanceled=function(t){},e.reconnectAfterClose=!0,e}return __extends(n,t),Object.defineProperty(n.prototype,"sid",{set:function(t){this._sid=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadType",{set:function(t){this._loadType=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"type",{set:function(t){this._type=t},enumerable:!0,configurable:!0}),n.prototype.connect=function(t){var e=this;this._domain=t;var n="";this._type,this._loadType,"ipl"==this._type?n="member"==this._loadType?"/infe/rest/flash/getServerIP.json":"/amfphp/json.php/Member.getServerList/1/":"Sball"==this._type&&(n="/infe/rest/flash/getServerIP.json"),this._sid,this.gatewayPath=n,ConnecterTools.getConnectIP(this.gatewayPath,function(t){return e.onGetIP(t)},function(){return e.getIPFailHandler()})},n.prototype.onGetIP=function(t){var e=t.ip;if("string"==typeof e)this._ip=t.ip.split(":")[0];else if(null!=e){var n=t.ip.length,i=this.getRandInt(0,n-1),o=t.ip[i].IP;this._ip=o.split(":")[0]}this._hallID=t.HallID,this._site=t.site,this.reconnectCounter=0,this.connectServer()},n.prototype.getConnectIP=function(t){var e=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE&&200==n.status){var t=JSON.parse(n.responseText);if(t.data,null!=t.data){var i=t.data.ip;if(i instanceof String)e._ip=t.data.ip.split(":")[0];else if(i instanceof Array){var o=t.data.ip.length,r=e.getRandInt(0,o-1),a=t.data.ip[r].IP;e._ip=a.split(":")[0]}e._hallID=t.data.HallID,e._site=t.data.site,e.reconnectCounter=0,e.connectServer()}else e.getIPFailHandler()}},n.open("GET",t,!0),n.addEventListener("progress",this.updateProgress),n.addEventListener("load",this.transferComplete),n.addEventListener("error",this.transferFailed),n.addEventListener("abort",this.transferCanceled),n.send()},n.prototype.getIPFailHandler=function(){var t=this;if(this.regetIPCounter>4);else{null!=this.regetIPTimer&&clearTimeout(this.regetIPTimer);var e,n=Math.floor(1800*Math.random()+64);this.regetIPCounter++,e=1==this.regetIPCounter?Math.floor(n/64):2==this.regetIPCounter?Math.floor(n/16):3==this.regetIPCounter?Math.floor(n/4):n,this.regetIPCounter,this.regetIPTimer=setTimeout(function(){t.connect(t._domain)},1e3*e)}},n.prototype.connectServer=function(){var t=this,n=this.getWSConnectPath();if(this._ip,document.location.protocol,this._type,this._loadType,!this.ws||this.ws.readyState!=WebSocket.OPEN){var i={hallID:this._hallID,url:n},o=new e(e.HALL_STATUS);o.data=i,this.dispatchEvent(o),this.ws=new WebSocket(n),this.ws.onopen=function(e){return t.webSocketEventHandler(e)},this.ws.onerror=function(e){return t.webSocketEventHandler(e)},this.ws.onclose=function(e){return t.webSocketEventHandler(e)},this.ws.onmessage=function(e){return t.webSocketEventHandler(e)}}},n.prototype.getRandInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},n.prototype.getWSConnectPath=function(){var t;return"ipl"==this._type?t="/fxdeepsea/FigLeaf/BigBallH"+this.getRandInt(1,5):"Sball"==this._type&&(t="/fxdeepsea/FigLeaf/SmallBall"),-1==document.location.protocol.indexOf("https")?"ws://"+document.location.hostname+t:"wss://"+document.location.hostname+t},n.prototype.connetingFailHandler=function(){var t=this;if(this.reconnectCounter>4);else{null!=this.reconnectTimer&&clearTimeout(this.reconnectTimer);var e,n=Math.floor(1800*Math.random()+64);this.reconnectCounter++,e=1==this.reconnectCounter?Math.floor(n/64):2==this.reconnectCounter?Math.floor(n/16):3==this.reconnectCounter?Math.floor(n/4):n,this.reconnectCounter,this.reconnectTimer=setTimeout(function(){t.connectServer()},1e3*e)}},n.prototype.webSocketEventHandler=function(t){switch(t.type){case"open":this.ws;break;case"close":this.connetingFailHandler();break;case"error":break;case"message":this.onMessage(t)}},n.prototype.onMessage=function(t){var e=JSON.parse(t.data);this.handleWSMessage(e)},n.prototype.handleWSMessage=function(t){"NetConnect.Success"==t.NetStatusEvent||("Connected.amfIsReady"==t.NetStatusEvent?this.onAmfReady():"Data"==t.NetStatusEvent?this.socketDatahandler(t):t.NetStatusEvent)},n.prototype.onAmfReady=function(){this.setUser({site:this._site,hallID:this._hallID});var t=new e(e.NET_STATUS);t.status="NetConnection.Connect.Success",t.data="CONNECT_SUCCESS",this.dispatchEvent(t)},n.prototype.socketDatahandler=function(t){t.cmd,this[t.cmd].apply(this,t.args)},n.prototype.sCD1=function(t){var n=new e(e.COUNTDOWN1);n.data=t,this.dispatchEvent(n)},n.prototype.sCD2=function(t){var n=new e(e.COUNTDOWN2);n.data=t,this.dispatchEvent(n)},n.prototype.mtst=function(t){var n=new e(e.MAINTAIN_START);n.data=t,this.dispatchEvent(n)},n.prototype.ums=function(t){var n=new e(e.UNDER_MAINTAIN_SEQUENCE);n.data=t,this.dispatchEvent(n)},n.prototype.mqe=function(t){var n=new e(e.MARQUEE);n.data=t,this.dispatchEvent(n)},n.prototype.chk=function(){},n.prototype.mti=function(t){var n=new e(e.MAINTAIN_INFO);n.data=t,this.dispatchEvent(n)},n.prototype.OutputTxt=function(t){var n=new e(e.OUTPUT_DATA);n.data=new Object,n.data.output=t,this.dispatchEvent(n)},n.prototype.setUser=function(t,e){this.cmd("setUser",t)},n.prototype.setLang=function(t){this._lang!=t&&(this._lang=t,this.cmd("setLang",t))},n.prototype.setSid=function(t){this.cmd("setSid",t)},n.prototype.cmd=function(t,e){var n={event:t,data:[e]};this.callServer(n)},n.prototype.callServer=function(t){if(this.ws.readyState==WebSocket.OPEN){var e=JSON.stringify(t);this.ws.send(e)}else this.ws.readyState},n.prototype.close=function(t){1!=t&&(this.reconnectAfterClose=!1),this.ws.close()},n}(H5EventdispatcherCore.EventDispatcher);t.FigLeaf=n}(FigLeafClient||(FigLeafClient={}));var URLTools;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"isLocal",{get:function(){return-1!=window.location.host.indexOf("localhost")||-1!=window.location.host.indexOf("192.168")||-1!=window.location.host.indexOf("127.0.0.1")},enumerable:!0,configurable:!0}),t.getPatamFromURL=function(e,n){return null==n?t.parseParamString(e):t.parseParamString(e)[n]},t.getParam=function(e){return null==e?t.parseParamString(window.location.search):t.parseParamString(window.location.search)[e]},t.callJS=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];[].slice.call(arguments).splice(2);for(var o=t.split("."),r=o.pop(),a=0;a<o.length;a++)e=e[o[a]];return e[r]?(s=e[r]).apply.apply(s,[e].concat(n)):null;var s},t.parseParamString=function(t){for(var e,n,i,o=/(([^?&=]+)(?:=([^?&=]*))*)/g,r={};e=o.exec(t);)n=e[2],i=e[3]||"",r[n]=decodeURIComponent(i);return r},t}();t.URLParser=e}(URLTools||(URLTools={}));var faelgif;window.addEventListener("load",function(){initFigLeaf()});var FigLeafClient;!function(t){var e=URLTools.URLParser,n=t.FigLeaf,i=t.FigLeafEvent,o=function(){function o(){var e=this;this._lang="",this._sid="",this.netStatusHandler=function(t){if(t.type,t.data,e.executeFunctionByName("figLeaf",window,[t.type,t.data]),"NetConnection.Connect.Success"==t.status){if(""!=e._lang){var n=e.TransLang(e._lang);e.outterCommandCall("setLang",n)}""!=e._sid&&(e._sid,e.outterCommandCall("setSid",e._sid))}},this.FigLeafHandler=function(t){t.type,t.data,t.type==i.MAINTAIN_INFO?1==t.data.mtst?e.executeFunctionByName("figLeaf",window,[t.type,t.data.mtst,t.data.spt,t.data.t1]):e.executeFunctionByName("figLeaf",window,[t.type,t.data.mtst]):e.executeFunctionByName("figLeaf",window,[t.type,t.data])},this._path=document.location.origin,this.initPath=this._path,this.initPath,this.figLeaf=new n,this.getLoadType(),this.figLeaf.type=t.Main.MainType,this.figLeaf.loadType=this.getLoadType(),this.figLeaf.connect(this._path),this.figLeaf.addEventListener(i.NET_STATUS,this.netStatusHandler),this.figLeaf.addEventListener(i.COUNTDOWN1,this.FigLeafHandler),this.figLeaf.addEventListener(i.COUNTDOWN2,this.FigLeafHandler),this.figLeaf.addEventListener(i.MAINTAIN_START,this.FigLeafHandler),this.figLeaf.addEventListener(i.UNDER_MAINTAIN_SEQUENCE,this.FigLeafHandler),this.figLeaf.addEventListener(i.MARQUEE,this.FigLeafHandler),this.figLeaf.addEventListener(i.MAINTAIN_INFO,this.FigLeafHandler)}return o.prototype.getLoadType=function(){var t=document.getElementById("figLeaf");return e.getPatamFromURL(t.src,"site")},o.prototype.outterCommandCall=function(t,e){if("setLang"==t&&this._lang!=e){this._lang=e;var n=this.TransLang(e);this.figLeaf.cmd(t,n)}else"setSid"==t&&this._sid!=e?(this._sid=e,this.figLeaf.cmd("setSid",this._sid)):this.figLeaf.cmd(t,e)},o.prototype.executeFunctionByName=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];[].slice.call(arguments).splice(2);for(var o=t.split("."),r=o.pop(),a=0;a<o.length;a++)e=e[o[a]];return(s=e[r]).apply.apply(s,[e].concat(n));var s},o.prototype.TransLang=function(t){return"big5"==t||"zh-tw"==t?"tw":"gb"==t||"zh-cn"==t?"cn":"es"==t||"en-es"==t?"es":"th"==t||"th-tis"==t?"th":"vi"==t||"vn"==t?"vn":"ja"==t||"jp"==t||"euc-jp"==t?"jp":"ko"==t||"euc-kr"==t?"kr":"km"==t||"khm"==t?"km":"lo"==t||"lao"==t?"lao":"cn"},o.MainType="ipl",o}();t.Main=o}(FigLeafClient||(FigLeafClient={}));